<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculate your website's carbon footprint instantly - 100% client-side analysis">
    <title>Green Website Carbon Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --eco-green: #2ecc71;
            --dark-bg: #1a1a1a;
            --text-light: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', system-ui;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--dark-bg);
            color: var(--text-light);
            line-height: 1.6;
        }

        .header {
            text-align: center;
            margin: 3rem 0;
            padding: 2rem;
            border-bottom: 2px solid var(--eco-green);
        }

        .input-group {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        input, select, button {
            padding: 0.8rem;
            border: 1px solid #444;
            border-radius: 8px;
            background: #333;
            color: var(--text-light);
            font-size: 1rem;
        }

        button {
            background: var(--eco-green);
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover {
            opacity: 0.9;
        }

        .result-section {
            background: #ffffff08;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            display: none;
        }

        .eco-badge {
            background: #2ecc7120;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
            text-align: center;
        }

        #carbonChart {
            margin: 2rem auto;
            max-width: 600px;
        }

        .ads {
            margin: 2rem 0;
            text-align: center;
            padding: 1rem;
            background: #ffffff08;
            border-radius: 8px;
        }

        #error-box {
            display: none;
            color: #ff4444;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid #ff4444;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå± Green Website Carbon Calculator</h1>
        <p>Measure your website's environmental impact in real-time</p>
    </div>

    <div class="input-group">
        <input type="url" id="websiteUrl" 
               placeholder="Enter website URL (e.g., https://example.com)" 
               autocomplete="off">
        <select id="hostingType">
            <option value="green">üåø Green Hosting</option>
            <option value="standard">‚ö° Standard Hosting</option>
        </select>
        <button onclick="initAnalysis()">Calculate Carbon Footprint</button>
    </div>

    <div class="ads">
        <!-- AdSense Placeholder -->
        <!-- Replace with your AdSense code -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
             data-ad-slot="XXXXXXXXXX"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
    </div>

    <div id="error-box"></div>

    <div class="result-section" id="resultSection">
        <h2>Analysis Results</h2>
        <div class="eco-badge">
            <h3>üåç Your website emits <span id="co2Amount">0.00g</span> CO‚ÇÇ per visit</h3>
            <p>Equivalent to driving <span id="equivalence">0.000 miles</span> in a gas car</p>
        </div>

        <canvas id="carbonChart"></canvas>

        <div class="input-group">
            <button onclick="generateBadge()">üñºÔ∏è Download Eco Badge</button>
            <button onclick="shareResults()">üì§ Share Results</button>
        </div>
    </div>

    <script>
        // Anti-copy protection
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = e => (e.ctrlKey && e.shiftKey && e.key === 'I') && e.preventDefault();

        // Core functionality
        const HostingFactors = {green:0.3,standard:0.7};
        let currentChart = null;

        async function initAnalysis() {
            try {
                const url = document.getElementById('websiteUrl').value;
                const hosting = document.getElementById('hostingType').value;
                
                if(!validateUrl(url)) throw new Error('Invalid URL format');
                showLoading(true);
                
                const emissions = await calculateEmissions(url, hosting);
                displayResults(emissions);
            } catch(err) {
                showError(err.message);
            } finally {
                showLoading(false);
            }
        }

        function validateUrl(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        async function calculateEmissions(url, hostingType) {
            return new Promise((resolve, reject) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                
                iframe.onload = () => {
                    try {
                        const resources = performance.getEntriesByType('resource');
                        const totalBytes = resources.reduce((sum, res) => sum + (res.transferSize || 0), 0);
                        const mb = totalBytes / (1024 ** 2);
                        const factor = HostingFactors[hostingType] || 0.7;
                        const co2 = (mb * 0.5 + factor).toFixed(2);
                        resolve({co2, mb});
                    } catch(err) {
                        reject(err);
                    } finally {
                        iframe.remove();
                    }
                };

                iframe.onerror = () => reject(new Error('Failed to analyze website'));
                iframe.src = url;
                document.body.appendChild(iframe);
            });
        }

        function displayResults({co2, mb}) {
            document.getElementById('resultSection').style.display = 'block';
            document.getElementById('co2Amount').textContent = `${co2}g`;
            document.getElementById('equivalence').textContent = `${(co2 / 404).toFixed(3)} miles`;
            
            if(currentChart) currentChart.destroy();
            const ctx = document.getElementById('carbonChart').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Your Website', 'Industry Average'],
                    datasets: [{
                        label: 'CO‚ÇÇ Emissions (grams per visit)',
                        data: [co2, 1.8],
                        backgroundColor: [getComputedStyle(document.documentElement)
                            .getPropertyValue('--eco-green'), '#666']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {position: 'top'},
                        title: {display: true, text: 'Carbon Footprint Comparison'}
                    }
                }
            });
        }

        function generateBadge() {
            const co2 = document.getElementById('co2Amount').textContent;
            const svg = `<svg width="300" height="150" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" rx="8" fill="#2ecc7120"/>
                <text x="50%" y="50%" font-family="Arial" font-size="20" 
                      fill="#2ecc71" text-anchor="middle" dominant-baseline="middle">
                    ${co2} CO‚ÇÇ/visit
                </text>
            </svg>`;
            
            const blob = new Blob([svg], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'eco-badge.svg';
            a.click();
        }

        function shareResults() {
            const co2 = document.getElementById('co2Amount').textContent;
            const text = `My website emits ${co2} of CO‚ÇÇ per visit - check yours! ${location.href}`;
            
            if(navigator.share) {
                navigator.share({title: 'Carbon Analysis', text});
            } else {
                prompt('Copy to share:', text);
            }
        }

        function showError(message) {
            const errorBox = document.getElementById('error-box');
            errorBox.textContent = `Error: ${message}`;
            errorBox.style.display = 'block';
            setTimeout(() => errorBox.style.display = 'none', 5000);
        }

        function showLoading(show) {
            document.querySelectorAll('button').forEach(btn => 
                btn.disabled = show
            );
        }
    </script>
</body>
</html>